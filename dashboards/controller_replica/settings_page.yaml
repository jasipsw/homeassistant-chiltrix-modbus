# Chiltrix Controller - Settings Page
# Temperature adjustments and system configuration

type: vertical-stack
cards:
  # Header with Back Button
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: ← Back
        tap_action:
          action: navigate
          navigation_path: /lovelace/chiltrix-main
        styles:
          card:
            - background: 'linear-gradient(135deg, #4a5568 0%, #2d3748 100%)'
            - height: 60px
          name:
            - color: white
            - font-size: 20px
            - font-weight: bold
      
      - type: markdown
        content: |
          <div style="text-align: center; padding: 15px; font-size: 24px; font-weight: bold; color: #2d3748;">
          SETTINGS & CONTROL
          </div>
        style: |
          ha-card {
            background: linear-gradient(135deg, #5DCCCC 0%, #4AB8B8 100%);
            box-shadow: none;
            border: none;
          }

  # ========================================================================
  # HEATING SETPOINT CONTROL
  # ========================================================================
  
  - type: custom:button-card
    name: " "
    styles:
      card:
        - background: 'linear-gradient(135deg, #FF6B6B 0%, #C92A2A 100%)'
        - padding: 20px
        - border-radius: 15px
        - box-shadow: '0 4px 8px rgba(0,0,0,0.3)'
    custom_fields:
      heating_control: |
        <div style="text-align: center; color: white;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px;">
            <ha-icon icon="mdi:fire" style="width: 40px; height: 40px;"></ha-icon>
            <h2 style="margin: 0;">HEATING TARGET TEMPERATURE</h2>
          </div>
          <div style="font-size: 72px; font-weight: bold; margin: 20px 0;">
            {{ states('sensor.cx_setpoint_temperature') }}°C
          </div>
          <div style="font-size: 18px; opacity: 0.9;">
            Current: {{ states('sensor.cx_water_outlet_temperature') }}°C
          </div>
        </div>
  
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: "-5°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_heating_setpoint
            value: >
              [[[ return Math.max(15, parseFloat(states['sensor.cx_setpoint_temperature'].state) - 5); ]]]
        styles:
          card:
            - background: '#C92A2A'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "-1°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_heating_setpoint
            value: >
              [[[ return Math.max(15, parseFloat(states['sensor.cx_setpoint_temperature'].state) - 1); ]]]
        styles:
          card:
            - background: '#E03131'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "+1°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_heating_setpoint
            value: >
              [[[ return Math.min(60, parseFloat(states['sensor.cx_setpoint_temperature'].state) + 1); ]]]
        styles:
          card:
            - background: '#FF6B6B'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "+5°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_heating_setpoint
            value: >
              [[[ return Math.min(60, parseFloat(states['sensor.cx_setpoint_temperature'].state) + 5); ]]]
        styles:
          card:
            - background: '#FF8787'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white

  # ========================================================================
  # COOLING SETPOINT CONTROL
  # ========================================================================
  
  - type: custom:button-card
    name: " "
    styles:
      card:
        - background: 'linear-gradient(135deg, #4ECDC4 0%, #1A535C 100%)'
        - padding: 20px
        - border-radius: 15px
        - box-shadow: '0 4px 8px rgba(0,0,0,0.3)'
        - margin-top: 20px
    custom_fields:
      cooling_control: |
        <div style="text-align: center; color: white;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px;">
            <ha-icon icon="mdi:snowflake" style="width: 40px; height: 40px;"></ha-icon>
            <h2 style="margin: 0;">COOLING TARGET TEMPERATURE</h2>
          </div>
          <div style="font-size: 72px; font-weight: bold; margin: 20px 0;">
            {{ states('sensor.cx_setpoint_temperature') }}°C
          </div>
          <div style="font-size: 18px; opacity: 0.9;">
            Current: {{ states('sensor.cx_water_outlet_temperature') }}°C
          </div>
        </div>
  
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: "-5°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_cooling_setpoint
            value: >
              [[[ return Math.max(15, parseFloat(states['sensor.cx_setpoint_temperature'].state) - 5); ]]]
        styles:
          card:
            - background: '#1A535C'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "-1°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_cooling_setpoint
            value: >
              [[[ return Math.max(15, parseFloat(states['sensor.cx_setpoint_temperature'].state) - 1); ]]]
        styles:
          card:
            - background: '#2A838C'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "+1°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_cooling_setpoint
            value: >
              [[[ return Math.min(60, parseFloat(states['sensor.cx_setpoint_temperature'].state) + 1); ]]]
        styles:
          card:
            - background: '#4ECDC4'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "+5°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_cooling_setpoint
            value: >
              [[[ return Math.min(60, parseFloat(states['sensor.cx_setpoint_temperature'].state) + 5); ]]]
        styles:
          card:
            - background: '#6EDDD6'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white

  # ========================================================================
  # DHW SETPOINT CONTROL
  # ========================================================================
  
  - type: custom:button-card
    name: " "
    styles:
      card:
        - background: 'linear-gradient(135deg, #FFD93D 0%, #F6A623 100%)'
        - padding: 20px
        - border-radius: 15px
        - box-shadow: '0 4px 8px rgba(0,0,0,0.3)'
        - margin-top: 20px
    custom_fields:
      dhw_control: |
        <div style="text-align: center; color: white;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px;">
            <ha-icon icon="mdi:water-boiler" style="width: 40px; height: 40px;"></ha-icon>
            <h2 style="margin: 0;">DHW TARGET TEMPERATURE</h2>
          </div>
          <div style="font-size: 72px; font-weight: bold; margin: 20px 0;">
            {{ states('sensor.cx_dhw_setpoint') }}°C
          </div>
          <div style="font-size: 18px; opacity: 0.9;">
            Range: 35°C - 65°C
          </div>
        </div>
  
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: "-5°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_dhw_setpoint
            value: >
              [[[ return Math.max(35, parseFloat(states['sensor.cx_dhw_setpoint'].state) - 5); ]]]
        styles:
          card:
            - background: '#F6A623'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "-1°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_dhw_setpoint
            value: >
              [[[ return Math.max(35, parseFloat(states['sensor.cx_dhw_setpoint'].state) - 1); ]]]
        styles:
          card:
            - background: '#F8B84E'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "+1°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_dhw_setpoint
            value: >
              [[[ return Math.min(65, parseFloat(states['sensor.cx_dhw_setpoint'].state) + 1); ]]]
        styles:
          card:
            - background: '#FFD93D'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white
      
      - type: custom:button-card
        name: "+5°C"
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.cx_dhw_setpoint
            value: >
              [[[ return Math.min(65, parseFloat(states['sensor.cx_dhw_setpoint'].state) + 5); ]]]
        styles:
          card:
            - background: '#FFE66D'
            - height: 80px
          name:
            - font-size: 24px
            - font-weight: bold
            - color: white

  # ========================================================================
  # SYSTEM CONTROLS
  # ========================================================================
  
  - type: entities
    title: System Controls
    show_header_toggle: false
    style: |
      ha-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 2px solid #dee2e6;
        margin-top: 20px;
      }
    entities:
      - entity: switch.cx_silent_mode_control
        name: Silent Mode
        icon: mdi:volume-off
      - entity: switch.cx_dhw_priority_control
        name: DHW Priority Mode
        icon: mdi:water-boiler-alert
      - type: divider
      - entity: input_number.cx_electric_rate_flat
        name: Electricity Rate
        icon: mdi:currency-usd
      - entity: input_number.cx_fluid_specific_heat
        name: Fluid Specific Heat
        icon: mdi:water-thermometer
      - entity: input_number.cx_fluid_density
        name: Fluid Density
        icon: mdi:weight

  # Quick Preset Buttons
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: ECO MODE
        icon: mdi:leaf
        tap_action:
          action: call-service
          service: script.cx_eco_mode
        styles:
          card:
            - background: 'linear-gradient(135deg, #51CF66 0%, #37B24D 100%)'
            - height: 80px
          name:
            - font-size: 18px
            - color: white
          icon:
            - color: white
            - width: 30px
      
      - type: custom:button-card
        name: COMFORT
        icon: mdi:home-thermometer
        tap_action:
          action: call-service
          service: script.cx_comfort_mode
        styles:
          card:
            - background: 'linear-gradient(135deg, #FFD93D 0%, #FAB005 100%)'
            - height: 80px
          name:
            - font-size: 18px
            - color: white
          icon:
            - color: white
            - width: 30px
      
      - type: custom:button-card
        name: BOOST
        icon: mdi:speedometer
        tap_action:
          action: call-service
          service: script.cx_boost_mode
        styles:
          card:
            - background: 'linear-gradient(135deg, #FF6B6B 0%, #FA5252 100%)'
            - height: 80px
          name:
            - font-size: 18px
            - color: white
          icon:
            - color: white
            - width: 30px