# Chiltrix Heat Pump COP Dashboard Card
# Compatible with: CX34, CX35, CX50-2, and other Chiltrix models
# Add this to your Lovelace dashboard (ui-lovelace.yaml or via UI editor)

# ============================================================================
# MAIN COP MONITORING CARD
# ============================================================================

type: vertical-stack
cards:
  # Header Card
  - type: markdown
    content: |
      # üî• Chiltrix Heat Pump Performance
      ### Coefficient of Performance (COP) Monitoring
  
  # Current COP Status
  - type: entities
    title: Current Performance
    show_header_toggle: false
    entities:
      - entity: sensor.cx_cop
        name: Overall COP
        icon: mdi:gauge
      - entity: sensor.cx_efficiency_rating
        name: Efficiency Rating
      - type: divider
      - entity: sensor.cx_thermal_power_output
        name: Thermal Output
        icon: mdi:fire
      - entity: sensor.cx_electrical_energy_input
        name: Electrical Input
        icon: mdi:lightning-bolt
      - entity: sensor.cx_water_temperature_delta
        name: Temperature Delta (ŒîT)
        icon: mdi:delta
  
  # Mode-Specific COP
  - type: entities
    title: COP by Operating Mode
    show_header_toggle: false
    entities:
      - entity: sensor.cx_cop_heating_mode
        name: Heating Mode
        icon: mdi:fire
      - entity: sensor.cx_cop_cooling_mode
        name: Cooling Mode
        icon: mdi:snowflake
      - entity: sensor.cx_cop_dhw_mode
        name: DHW Mode
        icon: mdi:water-boiler
      - type: divider
      - entity: sensor.cx_cop_heating_with_dhw
        name: Heating + DHW Priority
        icon: mdi:fire-circle
      - entity: sensor.cx_cop_heating_without_dhw
        name: Heating Only
        icon: mdi:fire
      - entity: sensor.cx_cop_cooling_with_dhw
        name: Cooling + DHW Priority
        icon: mdi:snowflake-thermometer
      - entity: sensor.cx_cop_cooling_without_dhw
        name: Cooling Only
        icon: mdi:snowflake
  
  # Fluid Configuration
  - type: entities
    title: Fluid Properties Configuration
    show_header_toggle: false
    entities:
      - entity: input_number.cx_fluid_specific_heat
        name: Specific Heat Capacity
      - entity: input_number.cx_fluid_density
        name: Fluid Density
      - type: divider
      - entity: sensor.cx_flow_rate
        name: Current Flow Rate
        icon: mdi:waves

# ============================================================================
# COP HISTORY GRAPH
# ============================================================================

  - type: history-graph
    title: COP History (24 Hours)
    hours_to_show: 24
    refresh_interval: 60
    entities:
      - entity: sensor.cx_cop
        name: Overall COP
      - entity: sensor.cx_cop_heating_mode
        name: Heating
      - entity: sensor.cx_cop_cooling_mode
        name: Cooling
      - entity: sensor.cx_cop_dhw_mode
        name: DHW

# ============================================================================
# POWER COMPARISON CHART
# ============================================================================

  - type: custom:apexcharts-card
    header:
      show: true
      title: Power Input vs Thermal Output
      show_states: true
    graph_span: 24h
    series:
      - entity: sensor.cx_thermal_power_output
        name: Thermal Output
        type: line
        color: orange
        stroke_width: 2
      - entity: sensor.cx_electrical_energy_input
        name: Electrical Input
        type: line
        color: blue
        stroke_width: 2
    # Note: Requires custom:apexcharts-card from HACS
    # Install via HACS -> Frontend -> Search "ApexCharts"

# ============================================================================
# ALTERNATIVE: SIMPLE GAUGE CARDS (No custom components needed)
# ============================================================================

  - type: horizontal-stack
    cards:
      - type: gauge
        entity: sensor.cx_cop
        name: Current COP
        min: 0
        max: 6
        severity:
          green: 3.5
          yellow: 2.5
          red: 0
        needle: true
      
      - type: gauge
        entity: sensor.cx_thermal_power_output
        name: Thermal Power
        min: 0
        max: 20
        unit: kW
        needle: true
      
      - type: gauge
        entity: sensor.cx_current_power
        name: Electric Power
        min: 0
        max: 5000
        unit: W
        needle: true

# ============================================================================
# STATISTICS CARD (Long-term Performance)
# ============================================================================

  - type: entities
    title: Performance Statistics
    show_header_toggle: false
    entities:
      - entity: sensor.cx_cop_avg_hourly
        name: Average COP (Last Hour)
        icon: mdi:clock-outline
      - entity: sensor.cx_cop_avg_daily
        name: Average COP (Last 24h)
        icon: mdi:calendar-today
      - entity: sensor.cx_run_hours
        name: Total Runtime
        icon: mdi:clock-time-eight
      - entity: sensor.cx_compressor_starts
        name: Compressor Cycles
        icon: mdi:counter

# ============================================================================
# COMPACT GLANCE CARD (Alternative minimal view)
# ============================================================================

  - type: glance
    title: Quick Status
    columns: 4
    entities:
      - entity: sensor.cx_cop
        name: COP
      - entity: sensor.cx_water_inlet_temperature
        name: Inlet
      - entity: sensor.cx_water_outlet_temperature
        name: Outlet
      - entity: sensor.cx_current_power
        name: Power
      - entity: sensor.cx_flow_rate
        name: Flow
      - entity: sensor.cx_compressor_speed
        name: Comp
      - entity: sensor.cx_fan_speed
        name: Fan
      - entity: sensor.cx_pump_speed
        name: Pump

# ============================================================================
# CONDITIONAL CARD - Shows different COP based on current mode
# ============================================================================

  - type: conditional
    conditions:
      - entity: sensor.cx_operating_state
        state: "1"
    card:
      type: markdown
      content: |
        ### üî• Heating Mode Active
        **Current COP:** {{ states('sensor.cx_cop_heating_mode') }}
        {% if is_state('binary_sensor.cx_dhw_priority', 'on') %}
        üö∞ DHW Priority: **Enabled**
        {% else %}
        DHW Priority: Disabled
        {% endif %}

  - type: conditional
    conditions:
      - entity: sensor.cx_operating_state
        state: "2"
    card:
      type: markdown
      content: |
        ### ‚ùÑÔ∏è Cooling Mode Active
        **Current COP:** {{ states('sensor.cx_cop_cooling_mode') }}
        {% if is_state('binary_sensor.cx_dhw_priority', 'on') %}
        üö∞ DHW Priority: **Enabled**
        {% else %}
        DHW Priority: Disabled
        {% endif %}

  - type: conditional
    conditions:
      - entity: sensor.cx_operating_state
        state: "4"
    card:
      type: markdown
      content: |
        ### üö∞ DHW Mode Active
        **Current COP:** {{ states('sensor.cx_cop_dhw_mode') }}
        Hot water heating in progress

# ============================================================================
# MOBILE-FRIENDLY COMPACT VIEW
# ============================================================================

# Uncomment for a more mobile-friendly single card:
# - type: picture-elements
#   image: /local/heatpump_background.png  # Optional background image
#   elements:
#     - type: state-label
#       entity: sensor.cx_cop
#       prefix: "COP: "
#       style:
#         top: 20%
#         left: 50%
#         font-size: 32px
#         font-weight: bold
#         color: white
#     - type: state-label
#       entity: sensor.cx_thermal_power_output
#       prefix: "Output: "
#       suffix: " kW"
#       style:
#         top: 40%
#         left: 50%
#         font-size: 24px
#         color: white
